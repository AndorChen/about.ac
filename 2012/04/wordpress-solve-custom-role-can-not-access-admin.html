<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"/><title>新用户角色无法访问后台的解决方法 - Andor Chen</title><meta name="description" content="安道的个人网站"/><meta name="author" content="安道"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.2.0/css/bootstrap.min.css"/><link rel="stylesheet" href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css"/><link rel="stylesheet" href="/assets/style.css"/></head><body><div class="wrapper"><div class="inner"> <header class="site-header clearfix"><div class="avatar"> <a href="/" title="首页"><img src="/assets/images/andor@2x.jpg" width="180" height="180" alt="" title=""/></a></div><h1 class="logo"><a href="/" title="首页">安道</a></h1> </header><div class="breadcrumbs"> <a href="/" title="首页">首页</a> // <a href="/archive/" title="文章归档">文章归档</a> // 新用户角色无法访问后台的解决方法</div><article class="hentry entry post"> <header class="entry-header"><h1 class="entry-title">新用户角色无法访问后台的解决方法</h1><p class="entry-meta">发布于2012年4月7日</p> </header><div class="entry-content"><p>在最近的一个项目中要添加一些新的用户角色，这本是一件很简单的事情，网上有很多教程可以参考。但是在实际的使用过程中却遇到了一个问题：新添加的用户角色所辖的用户无法进入后台，提示权限不足。即便是 WordPress 默认角色中权限最低的“订阅者”也是可以进入后台查看个人资料的。这是怎么回事呢？经过一个多小时的反复实验，最终找到一个解决方法。</p><p>以下是这个解决方法的代码片段，请灵活使用。</p><div class="highlighter-rouge"><pre class="highlight"><code>add_role( 'customer', 'Customer', array() );

$role = &amp;get_role( 'customer' );
$role-&gt;add_cap( 'custom_cap' );
</code></pre></div><p><code class="highlighter-rouge">add_role</code> 的用法在<a href="http://codex.wordpress.org/Function_Reference/add_role" title="文档中">文档中</a>说的很明白，第三个参数是给这个新角色指定一个所拥有权限的数组，比如“订阅者”的权限是 <code class="highlighter-rouge">array( 'read' )</code>。但是，如果此时指定了权限（比如 <code class="highlighter-rouge">read</code>），这个新角色下的用户是无法进入后台的，也就是出现前面所说的“权限不足”的问题。上述代码片段的第 2、3 行代码可以解决这个问题。</p><p><strong>解决方法</strong>：在用 <code class="highlighter-rouge">add_role</code> 添加新用户角色时暂不指定任何权限，也就是给其第三个参数赋值一个空数组。然后通过 <code class="highlighter-rouge">get_role</code> 获取刚刚添加的新用户角色，再使用 <code class="highlighter-rouge">add_cap</code> 为其添加相应的权限。如果需要添加多个权限，需要多次调用 <code class="highlighter-rouge">add_cap</code>。</p><p>以上是对“新添加的用户角色所辖的用户无法进入后台”这个问题的一种解决方法。这可能是 WordPress 的一个 bug。</p></div><ul class="entry-tags"><li><a class="btn btn-default btn-sm" href="/tags/#wordpress-ref" title="WordPress">WordPress</a></li></ul> </article><ul class="pager"><li class="previous"> <a rel="prev" href="/2012/02/wordpress-i18n-l10n.html" title="WordPress 的 i18n 和 l10n 流程">« 上一篇文章</a></li><li class="next"> <a rel="next" href="/2012/04/install-ruby-with-rbenv.html" title="使用 rbenv 安装管理 Ruby">下一篇文章 »</a></li></ul><footer class="site-footer clearfix"><div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><ul class="socials"><li><a href="/feed.xml" title="订阅网站更新"><i class="fa fa-rss"></i></a></li><li><a href="mailto:andor.chen.27@gmail.com" title="电子邮件"><i class="fa fa-envelope-o"></i></a></li><li><a href="https://twitter.com/Andor_Chen" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="http://www.weibo.com/andor27/" title="微博" target="_blank"><i class="fa fa-weibo"></i></a></li><li><a href="https://github.com/AndorChen" title="GitHub" target="_blank"><i class="fa fa-github"></i></a></li><li><a class="douban" href="http://www.douban.com/people/Andor/" title="豆瓣" target="_blank">豆</a></li></ul><p class="copyright">© 1988- 2015。如无特殊说明，本站内容基于“<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" title="CC BY-NC-SA 3.0" target="_blank">CC BY-NC-SA 3.0</a>”发布。</p><p class="powered-by"><a href="http://jekyllrb.com" title="本站使用 Jekyll 生成" target="_blank"><img src="/assets/images/jekyll-logo@2x.png" width="60" height="24" alt="Jekyll Logo" title="本站使用 Jekyll 生成"/></a></p></div> </footer></div></div></body></html>