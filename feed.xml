<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Andor Chen</title>
    <description>安道的个人网站</description>
    <link>http://about.ac/</link>
    <atom:link href="http://about.ac/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Sat, 09 Apr 2016 04:21:48 +0000</pubDate>
    <lastBuildDate>Sat, 09 Apr 2016 04:21:48 +0000</lastBuildDate>
    <generator>Jekyll v3.1.1</generator>
    
      <item>
        <title>2015 年</title>
        <description>&lt;p&gt;又到一年一度写年终总结的时候。做自由翻译进入第二个年头了，相关的事情也逐渐进了正轨。&lt;/p&gt;

&lt;p&gt;今年翻译了7本书（按结束的时间顺序）：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/books/java-nutshell-6th/&quot; title=&quot;Java 技术手册（第6版）&quot;&gt;Java 技术手册（第6版）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/books/js-app-design/&quot; title=&quot;JavaScript Web 应用开发&quot;&gt;JavaScript Web 应用开发&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/books/modern-php/&quot; title=&quot;Modern PHP（中文版）&quot;&gt;Modern PHP（中文版）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://ember-china.com&quot; title=&quot;ember-cli 入门&quot;&gt;ember-cli 入门&lt;/a&gt;（自出版）&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/books/learning-angularjs/&quot; title=&quot;AngularJS 学习手册&quot;&gt;AngularJS 学习手册&lt;/a&gt;（未出版）&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/books/docker-up-and-running/&quot; title=&quot;Docker 即学即用&quot;&gt;Docker 即学即用&lt;/a&gt;（未出版）&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/books/css-manual-4th/&quot; title=&quot;CSS: The Missing Manual, 4th Edition&quot;&gt;CSS: The Missing Manual, 4th Edition&lt;/a&gt;（未出版）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;其中四本书出版了，也收到了翻译费用，所以生活没有像&lt;a href=&quot;/2014/12/2014.html&quot; title=&quot;2014 年年终总结&quot;&gt;去年那样&lt;/a&gt;“潦倒”。&lt;/p&gt;

&lt;p&gt;至于明年的计划，我定了一个大方向：&lt;/p&gt;

&lt;p&gt;从 Ruby 初级迈向中级！&lt;/p&gt;
</description>
        <pubDate>Thu, 31 Dec 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/12/2015.html</link>
        <guid isPermaLink="true">http://about.ac/2015/12/2015.html</guid>
        
        <category>Life</category>
        
        
      </item>
    
      <item>
        <title>Ruby on Rails 教程销售报告</title>
        <description>&lt;p&gt;&lt;strong&gt;按&lt;/strong&gt;：今天，《&lt;a href=&quot;http://railstutorial-china.org&quot; title=&quot;Ruby on Rails 教程&quot;&gt;Ruby on Rails 教程&lt;/a&gt;》在线阅读开放了最后两章，至此，整本书都可以&lt;a href=&quot;http://railstutorial-china.org/book&quot; title=&quot;免费在线阅读&quot;&gt;免费在线阅读&lt;/a&gt;。借此机会，总结一下这本书的销售情况。&lt;/p&gt;

&lt;p&gt;《Ruby on Rails 教程（原书第3版）》于 2014 年 10 上线销售电子书，至今已经过去了一年。下表是这一年各月的销售情况。&lt;/p&gt;

&lt;table class=&quot;table table-bordered text-center&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th class=&quot;text-center&quot; rowspan=&quot;2&quot;&gt;月份&lt;/th&gt;
            &lt;th class=&quot;text-center&quot; colspan=&quot;3&quot;&gt;销量&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;th class=&quot;text-center&quot;&gt;SelfStore&lt;/th&gt;
            &lt;th class=&quot;text-center&quot;&gt;Sellfy&lt;/th&gt;
            &lt;th class=&quot;text-center&quot;&gt;Leanpub&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;tr&gt;&lt;td&gt;2014.10&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;td&gt;17&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2014.11&lt;/td&gt;&lt;td&gt;66&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2014.12&lt;/td&gt;&lt;td&gt;77&lt;/td&gt;&lt;td&gt;5&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.01&lt;/td&gt;&lt;td&gt;55&lt;/td&gt;&lt;td&gt;5&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.02&lt;/td&gt;&lt;td&gt;45&lt;/td&gt;&lt;td&gt;9&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.03&lt;/td&gt;&lt;td&gt;41&lt;/td&gt;&lt;td&gt;6&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.04&lt;/td&gt;&lt;td&gt;48&lt;/td&gt;&lt;td&gt;7&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.05&lt;/td&gt;&lt;td&gt;46&lt;/td&gt;&lt;td&gt;5&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.06&lt;/td&gt;&lt;td&gt;31&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.07&lt;/td&gt;&lt;td&gt;31&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.08&lt;/td&gt;&lt;td&gt;33&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.09&lt;/td&gt;&lt;td&gt;25&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;2015.10&lt;/td&gt;&lt;td&gt;51&lt;/td&gt;&lt;td&gt;N/A&lt;/td&gt;&lt;td&gt;6&lt;/td&gt;&lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;在所有销量中，&lt;a href=&quot;https://selfstore.io/products/189&quot; title=&quot;到 SelfStore 购买 Ruby on Rails 教程&quot;&gt;SelfStore&lt;/a&gt; 的贡献最大，在此感谢 &lt;a href=&quot;http://chloerei.com/&quot; title=&quot;Rei&quot;&gt;Rei&lt;/a&gt; 开发的这个网站。此外，本书还在 Sellfy（10 月换成了 &lt;a href=&quot;https://leanpub.com/rails-tutorial-cn&quot; title=&quot;到 Leanpub 购买 Ruby on Rails 教程&quot;&gt;Leanpub&lt;/a&gt;）销售电子书，主要面对说中文的海外用户。&lt;/p&gt;

&lt;p&gt;再次感谢所有购买本书的读者！&lt;/p&gt;
</description>
        <pubDate>Wed, 04 Nov 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/11/rails-tutorial-report.html</link>
        <guid isPermaLink="true">http://about.ac/2015/11/rails-tutorial-report.html</guid>
        
        <category>eBook</category>
        
        
      </item>
    
      <item>
        <title>ePub 电子书排版最佳实践</title>
        <description>&lt;p&gt;在制作《&lt;a href=&quot;http://railstutorial-china.org&quot; title=&quot;Ruby on Rails 教程&quot;&gt;Ruby on Rails 教程&lt;/a&gt;》和《&lt;a href=&quot;http://jekyll-china.com/book/&quot; title=&quot;Jekyll 小书&quot;&gt;Jekyll 小书&lt;/a&gt;》电子书的过程中，积累了一些经验，班门弄斧，姑且称之为“最佳实践”吧。&lt;/p&gt;

&lt;h2&gt;没有“页”这个概念&lt;/h2&gt;

&lt;p&gt;这是大前提，制作 ePub 电子书时一定要谨记这一点。ePub 电子书是“流式”的，不像实体书和 PDF 电子书那样有“页”这个概念。因此，很多效果或功能在 ePub 电子书中实现不了，比如说页眉和页码等（ePub 阅读器通常会在屏幕上部实现“页眉”，显示当前查看的书名和章节名；而且也会“分页”，但对阅读器来说，这个页与实体书的页并不一样）。&lt;/p&gt;

&lt;p&gt;因为没有页码，书中的交叉引用不能简单地使用“参见 XX 页”，而要链接到章节名或章节序号。&lt;/p&gt;

&lt;h2&gt;ePub 文件是小型的静态网站&lt;/h2&gt;

&lt;p&gt;这也是一个核心概念。你可以把 ePub 电子书的扩展名改为 &lt;code class=&quot;highlighter-rouge&quot;&gt;.zip&lt;/code&gt;，然后解压。你会看到解压得到的基本上就是个简单的静态网站：有 XHTML 文件，有图像，有样式表。如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;├── META-INF/
├── OEBPS
│   ├── chapter1.xhtml
│   ├── chapter2.xhtml
│   ├── chapter3.xhtml
│   ├── cover.jpg
│   ├── epub.css
│   ├── images/
│   ├── package.opf
│   └── toc.ncx
└── mimetype
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当然，这个网站与我们平常所说的网站有所不同，这是由 Web 浏览器与 ePub 阅读器之间的功能差异造成的。例如，在 ePub 电子书中基本不能使用 JavaScript，对 SVG 的支持有限，只能使用部分 CSS 属性。不过，ePub 电子书可以嵌入字体。&lt;/p&gt;

&lt;h2&gt;交叉引用&lt;/h2&gt;

&lt;p&gt;交叉引用是指引用书内的某个部分，比如“参见 1.2.3 节”，“如图 2.7”，等等。交叉引用最好加上链接，因为电子书不像实体书那样可以来回翻阅，加入链接便于读者定位所引用的内容。&lt;/p&gt;

&lt;h2&gt;提供目录&lt;/h2&gt;

&lt;p&gt;ePub 阅读器一般都会使用特殊的交互方式显示目录，但不会自己去解析内容，再生成目录。所以我们要在 ePub 文件中加入目录，让阅读器读取。如果内容较多，想显示次级目录，比如“3.2 节”，一定要设定目录的层级，不要把所有目录都放在相同的层级。指定目录层级的方式是，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;navPoint&lt;/code&gt; 元素中嵌套 &lt;code class=&quot;highlighter-rouge&quot;&gt;navPoint&lt;/code&gt; 元素，如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;navMap&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;navPoint&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ch1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;navLabel&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;text&amp;gt;&lt;/span&gt;第 1 章&lt;span class=&quot;nt&quot;&gt;&amp;lt;/text&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/navLabel&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;content&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ch1.html#ch_1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;navPoint&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;h2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ch_1_1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;navLabel&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;text&amp;gt;&lt;/span&gt;1.1 节&lt;span class=&quot;nt&quot;&gt;&amp;lt;/text&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/navLabel&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;content&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ch1.html#ch_1_1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/navPoint&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/navPoint&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;navPoint&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ch2&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;navLabel&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;text&amp;gt;&lt;/span&gt;第 2 章&lt;span class=&quot;nt&quot;&gt;&amp;lt;/text&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/navLabel&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;content&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ch2.html#ch_2&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/navPoint&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/navMap&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2&gt;不要把整本书都放在一个 XHTML 文件里&lt;/h2&gt;

&lt;p&gt;一本书的内容有长有短，但是，不管多长，建议一章放在一个 XHTML 文件里，不要把整本书都放在一个 XHTML 文件里。如果都放在一个文件里，ePub 阅读器解析的速度会变慢。&lt;/p&gt;

&lt;h2&gt;重置默认样式&lt;/h2&gt;

&lt;p&gt;ePub 阅读器就像 Web 浏览器一样，会内置默认的样式。为了更好的掌控，实现较为统一的视觉效果，建议在样式表开头重置样式。比如说：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;applet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;iframe&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;h1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;h6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;blockquote&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;abbr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;acronym&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;big&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;cite&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;del&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;dfn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;em&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;font&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;img&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;ins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;kbd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;samp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;small&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;strike&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;strong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;sub&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;sup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;tt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;center&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;dl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;dd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;ol&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;ul&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;li&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;fieldset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;legend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;caption&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;tbody&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;tfoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;thead&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;tr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;th&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;td&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;margin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;outline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;vertical-align&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;baseline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;transparent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2&gt;按章“换页”&lt;/h2&gt;

&lt;p&gt;ePub 电子书虽然没有“页”这个概念，却可以换页（严格来说应该是“换屏”）。从视觉上来看，换页就是新起一屏显示内容，让相对独立的内容（例如两章）不连在一起。一般来说，建议每章结束后换页，使用下述 CSS 代码实现：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;.chapter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;page-break-after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;always&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2&gt;字体&lt;/h2&gt;

&lt;p&gt;ePub 阅读器底层的操作系统（例如 iOS，Android 和各种定制的 ROM）往往会提供不同的字体，因此不能期望读者的系统中一定有某个字体。设置字体时要指定通用字体族（&lt;code class=&quot;highlighter-rouge&quot;&gt;serif&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;sans-serif&lt;/code&gt; 或 &lt;code class=&quot;highlighter-rouge&quot;&gt;monospace&lt;/code&gt;），让阅读器或底层系统判断要使用哪个字体。当然，我们也可以指定各种系统中常用的字体，提供更好的阅读体验。&lt;/p&gt;

&lt;p&gt;如果十分想保持一致的阅读体验，还可以使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;@font-face&lt;/code&gt; 嵌入字体。但是要考虑嵌入的字体会不会让电子书的体积变得特别大，影响传输速度。&lt;/p&gt;

&lt;p&gt;如果指定了字体，而不是让阅读器自行判断该使用哪个字体，在 iBooks 中会遇到一个问题：没使用指定的字体。这个问题的解决方法是，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;.opf&lt;/code&gt; 文件中加入下述元素：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;property=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ibooks:specified-fonts&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/meta&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;添加这个属性后，你会发现，在 iBooks 的外观设置中，字体项目下多了一个“Original”。这个选项的意思是，使用电子书中指定的字体。&lt;/p&gt;

&lt;figure&gt;
&lt;img src=&quot;/assets/images/figures/ibooks-fonts.png&quot; alt=&quot;让 iBooks 使用指定的字体&quot; /&gt;
&lt;figcaption&gt;让 iBooks 使用指定的字体&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2&gt;字号&lt;/h2&gt;

&lt;p&gt;我想你一定有这样的经历——调整电子书的文字大小。这种情况经常出现，因此，不要使用固定字号，例如 &lt;code class=&quot;highlighter-rouge&quot;&gt;12px&lt;/code&gt;，而要使用便于缩放的字号单位。ePub 电子书的字号一般建议使用百分比为单位，比如 &lt;code class=&quot;highlighter-rouge&quot;&gt;80%&lt;/code&gt;。&lt;/p&gt;

&lt;h2&gt;为标题加序号&lt;/h2&gt;

&lt;p&gt;书中的各级标题往往使用不同于正文的字体和字号显示，但是在手持设备中，字号之间的差异并不明显。为了让读者对一本书的纲要有全局的认识，建议在标题前加上序号，例如：“1.2 二级标题”，“1.2.3 三级标题”。&lt;/p&gt;

&lt;h2&gt;考虑兼容性&lt;/h2&gt;

&lt;p&gt;是的，与浏览器一样，我们也要考虑 ePub 阅读器的兼容性。就我目前的观察，iBooks 对标准的支持是最好的。但我们不能期望所有读者都使用 iOS/OS X 系统。下面举个例子。&lt;/p&gt;

&lt;p&gt;我平常看书喜欢用多看（手机和平板），但是&lt;a href=&quot;/2014/06/duokan-xhtml-entities.html&quot; title=&quot;多看对 XHTML 实体的支持并不好&quot;&gt;多看对 XHTML 实体的支持并不好&lt;/a&gt;，有些特殊的符号显示不出来。这时就要专门针对多看编写样式：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;.symbol&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&#39;DK-SYMBOL&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;DK-SYMBOL&lt;/code&gt; 是多看自带的字体，用于显示一些特殊的字体。&lt;/p&gt;

&lt;h2&gt;其他&lt;/h2&gt;

&lt;p&gt;除了上面列出的几点之外，还有一些推荐的做法，在此不一一展开详述。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;不要定义大块背景色；&lt;/li&gt;
  &lt;li&gt;脚注加上返回链接；&lt;/li&gt;
  &lt;li&gt;尽量不使用某个阅读器专属的功能；&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sun, 13 Sep 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/09/epub-best-practices.html</link>
        <guid isPermaLink="true">http://about.ac/2015/09/epub-best-practices.html</guid>
        
        <category>eBook</category>
        
        
      </item>
    
      <item>
        <title>在电子书中渲染公式</title>
        <description>&lt;p&gt;昨天更新了《&lt;a href=&quot;http://railstutorial-china.org&quot; title=&quot;Ruby on Rails 教程&quot;&gt;Ruby on Rails 教程&lt;/a&gt;》，这次更新最大的变化是对公式的处理方式。这本书有一节用了几个公式，我使用的电子书工具链之前不支持转换公式，所以只能做些简单的处理：使用上下标。后来越看越不舒服，因此前几天抽空实现了 LaTex 式的显示效果。&lt;/p&gt;

&lt;p&gt;公式一直是我的电子书工具链所缺乏的功能之一，我也一直想解决，不过苦于没有合适的方法。前几天，O’Reilly 电子书方面的负责人（Sanders Kleinfeld）分享了&lt;a href=&quot;http://diagramcenter.org/webinars.html#mmlc&quot; title=&quot;他们的处理方式&quot;&gt;他们的处理方式&lt;/a&gt;，勾起了我解决这个问题的欲望。&lt;/p&gt;

&lt;p&gt;按照 Sanders 的分享，我首先尝试使用 &lt;a href=&quot;https://www.mathmlcloud.org/&quot; title=&quot;MathML Cloud&quot;&gt;MathML Cloud&lt;/a&gt;。不过这个服务提供的 API 不规范，尝试过程中多次遇到问题。这个服务的实现方式是&lt;a href=&quot;https://github.com/benetech/mmlc-api&quot; title=&quot;开源&quot;&gt;开源&lt;/a&gt;的，不过自己搭建很麻烦，又是 MongoDB，又是 Redis 的，所以我放弃了这个方案。&lt;/p&gt;

&lt;p&gt;随后我试着搜索，看有没有纯 Ruby 的解决方案，毕竟我的工具链是使用 Ruby 编写的。在 GitHub 中搜索，找到了 &lt;a href=&quot;https://github.com/gjtorikian/mathematical&quot; title=&quot;mathematical&quot;&gt;mathematical&lt;/a&gt;。这个 gem 为了提升“速度”，用了两个 C 语言扩展。正是这两个扩展让我放弃使用这个 gem。因为用到了 C 扩展，所以安装之前要先安装一些库，不过对于“新手”来说，这个过程像念咒语一样，根本不得要领，开发者说安装什么跟着做就是了，然而有时跟着做也没用。环境的差异害死人！在这个 gem 开发者的帮助下，成功编译了 C 扩展，可是使用过程中又遇到了问题：无法生成 SVG 和 png 图像。自己尝试解决无果后，我就放弃了这个 gem。&lt;/p&gt;

&lt;p&gt;这时，我又想起了 MathML Cloud，既然这个服务的实现方式是开源的，不妨看看它是如何渲染公式的。看了&lt;a href=&quot;https://github.com/benetech/mmlc-api/blob/1daa756cc68a2ab5b535410b3f968c9257e2400c/package.json#L26&quot; title=&quot;代码&quot;&gt;代码&lt;/a&gt;，发现 MathML Cloud 使用的是 &lt;a href=&quot;https://github.com/mathjax/MathJax-node&quot; title=&quot;MathJax-node&quot;&gt;MathJax-node&lt;/a&gt;。&lt;a href=&quot;https://www.mathjax.org/&quot; title=&quot;MathJax&quot;&gt;MathJax&lt;/a&gt; 应该是目前最成熟的公式解决方案，既然有 Node.js 版，集成到我的工具链中就不难了，因为 MathJax-node 提供了 CLI。经过一番编程之后，最终顺利把 MathJax-node 集成到我的工具链中。&lt;/p&gt;

&lt;p&gt;目前我是这样处理公式的：书稿中使用 LaTex 句法写公式（纯文本，便于管理），生成电子书时为不同的电子书格式生成不同格式的图像&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;PDF 和 HTML 格式用 SVG&lt;/li&gt;
  &lt;li&gt;ePub 和 mobi 格式用 png&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这么做遵循了“渐进增强”原则，因为 PDF 骨子里就是“矢量”的，最适合使用 SVG，而且目前大多数主流浏览器都支持 SVG，所以 HTML 格式也用了 SVG。但是 ePub 阅读器和 Kindle 等对 SVG 的支持并不好，只能使用图像；虽然缩放时的体验不好，但是至少还能辨识公式的内容。&lt;/p&gt;

&lt;p&gt;P.S. 我的电子书工具链是 &lt;a href=&quot;https://rubygems.org/gems/persie&quot; title=&quot;persie&quot;&gt;persie&lt;/a&gt;。这个工具之前是开源的，现在已经闭源，不过以前的版本仍然可以下载安装。&lt;/p&gt;
</description>
        <pubDate>Fri, 14 Aug 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/08/stem.html</link>
        <guid isPermaLink="true">http://about.ac/2015/08/stem.html</guid>
        
        <category>eBook</category>
        
        
      </item>
    
      <item>
        <title>docx 文件脚注的编号</title>
        <description>&lt;p&gt;最近，使用 &lt;a href=&quot;http://pandoc.org/&quot; title=&quot;pandoc&quot;&gt;pandoc&lt;/a&gt; 生成 docx 文件遇到一个问题。默认情况下，一个文档中的所有脚注是按顺序标号的。这其实没什么问题，因为“语义”上讲，这就是正确的编号方法。但是，我想实现的是“按章”编号。&lt;/p&gt;

&lt;p&gt;我之前已经从样式上区别了各章（方法参见《&lt;a href=&quot;/2015/06/docx-hack-guide.html&quot; title=&quot;docx 文件定制指南&quot;&gt;docx 文件定制指南&lt;/a&gt;》），即在一级标题之前换页。这只是“表面功夫”，Word 看到的仍是一个没有结构划分的文档。为了实现脚注按章编号，首先要想办法让 Word 知道每一章在哪里开始，在哪里结束，也就是从“语义”上实现分章。&lt;/p&gt;

&lt;p&gt;其实 Word 提供了这种功能——分节。不过在代码层级，实现起来有点复杂。根据 WordProcessingML 的定义，文档最后一节的相关属性在 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:body&lt;/code&gt; 元素中最后一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:sectPr&lt;/code&gt; 元素中定义，而之前每一节的相关属性都在各节最后一个段落（&lt;code class=&quot;highlighter-rouge&quot;&gt;w:p&lt;/code&gt;）的属性中定义，如下述代码所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;w:body&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!--第一节--&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:pPr&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:sectPr&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:sectPr&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:pPr&amp;gt;&lt;/span&gt;
        ...
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!--第二节--&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:pPr&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:sectPr&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:sectPr&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:pPr&amp;gt;&lt;/span&gt;
        ...
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!--最后一节--&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:p&amp;gt;&lt;/span&gt;...&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:p&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:sectPr&amp;gt;&lt;/span&gt;
        ...
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:sectPr&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:body&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;pandoc 所用的模板没有为最后一节指定任何属性，即只有 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;w:sectPr/&amp;gt;&lt;/code&gt;。所以，要想办法设置最后一节的属性，还要在每个一级标题之前的段落属性里插入 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;w:sectPr&amp;gt;&lt;/code&gt; 元素。这个好办，使用相关的 XML 处理库就行。如果使用 Ruby，可以用 &lt;a href=&quot;https://rubygems.org/gems/nokogiri&quot; title=&quot;nokogiri&quot;&gt;nokogiri&lt;/a&gt;。XML 的具体处理方法本文不再赘述。&lt;/p&gt;

&lt;p&gt;不过，要如何设置每一节的属性才能让脚注按章编号呢？按照 WordProcessingML 的定义，脚注的属性放在 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:footnotePr&lt;/code&gt; 元素中，控制编号方式的是 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:numRestart&lt;/code&gt; 元素。这个元素的值可以设为下述三个值中的一个：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;continuous&lt;/code&gt;（默认值）&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;eachSect&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;eachPage&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;从上可以看出，我们需要把这个元素的值设为 &lt;code class=&quot;highlighter-rouge&quot;&gt;eachSect&lt;/code&gt;，即开始新的一节时重新从头开始为脚注编号。最终设置的 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:sectPr&lt;/code&gt; 如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;w:sectPr&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:footnotePr&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;w:numRestart&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;w:val=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;eachSect&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:footnotePr&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/w:sectPr&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;如果想每页单独编号，可以把 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:numRestart&lt;/code&gt; 的值设为 &lt;code class=&quot;highlighter-rouge&quot;&gt;eachPage&lt;/code&gt;。&lt;/p&gt;
</description>
        <pubDate>Mon, 03 Aug 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/08/docx-footnotes-numbering.html</link>
        <guid isPermaLink="true">http://about.ac/2015/08/docx-footnotes-numbering.html</guid>
        
        <category>Dev</category>
        
        
      </item>
    
      <item>
        <title>翻译时对网址的处理</title>
        <description>&lt;p&gt;科技类书籍一般都会在文中使用链接，电子书排版时可以直接以“链接”的形式给出，但是出版纸质书时则要把链接的地址写入行间。这就牵涉到排版的问题，为了便于排版，节省空间，较长的网址一般会使用短网址形式给出。外文书经常使用的短网址服务是 bit.ly。众所周知，这个网站在国内是无法访问的，因此翻译时要做些处理。&lt;/p&gt;

&lt;p&gt;我目前的做法是，找到 bit.ly 短网址对应的原网址，然后使用国内的短网址服务（例如 dwz.cn）重新创建短网址。但是这么做也会遇到一些问题。例如，有些网址包含特定的“词”，国内的短网址服务拒绝提供服务。遇到这种情况，我一般直接给出原地址。还有一种常见的问题是，原网址本身也无法访问。至于无法访问的原因，无外乎三种：其一，原网址由于某些原因在国内无法访问；其二，原网址对应的页面已经不存在；其三，原网址对应的页面换用了其他网址。&lt;/p&gt;

&lt;p&gt;对第一类网址来说，比较好的方式是，转载原文，放到国内用户能访问的网站中。不过，这又会带来一些问题，比如说，版权问题，工作量问题。所以，遇到这类网址，目前我不会做任何处理，祈求读者有科学上网的途径。对第二类网址来说，可以使用网页缓存服务，例如 &lt;a href=&quot;https://archive.org&quot; title=&quot;https://archive.org&quot;&gt;https://archive.org&lt;/a&gt;。对第三类网址来说，建议找出新地址。有人可能觉得这么做“不忠于原文”，但要知道，翻译是“再创作”，创作的基础虽然是原文，但原文是有“时限”的。在这方面，计算机技术表现的最为突出，正所谓“出版就过时”，有时甚至更糟，“写着后文，前文就过时了”。翻译时，时间已经向后推移了，为了给读者提供翻译当下最正确的资讯，当然要使用最新的网址。&lt;/p&gt;

</description>
        <pubDate>Thu, 30 Jul 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/07/translate-urls.html</link>
        <guid isPermaLink="true">http://about.ac/2015/07/translate-urls.html</guid>
        
        <category>Translation</category>
        
        
      </item>
    
      <item>
        <title>docx 文件定制指南</title>
        <description>&lt;p&gt;我在“&lt;a href=&quot;/2015/05/apps-for-translator.html&quot; title=&quot;翻译时使用的应用&quot;&gt;翻译时使用的应用&lt;/a&gt;”一文中提到，因为最近翻译的一本书要求提供 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件，所以我第一次使用了 &lt;a href=&quot;http://pandoc.org/&quot; title=&quot;pandoc&quot;&gt;pandoc&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;Pandoc 是个很强大的工具，能在多种文件格式之间相互转换。不过，我使用 Pandoc 只是为了把 Markdown 文件转换成 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件，以便提供给出版社。Pandoc 能很好地完成这项工作，不过转换得到的 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件格式不符合我的要求，所以最近几天稍微研究了定制样式的问题。&lt;/p&gt;

&lt;h2&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 格式简介&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 是微软为 Word 软件开发的文件格式，其背后是一个国际标准——&lt;a href=&quot;http://officeopenxml.com/&quot; title=&quot;Office Open XML&quot;&gt;Office Open XML&lt;/a&gt;（简称 OOXML）。&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 其实是打包文件，把扩展名从 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 改为 &lt;code class=&quot;highlighter-rouge&quot;&gt;zip&lt;/code&gt; 就能使用解压软件打开，看到其中的内容。解压后的文件结构如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.
├── [Content_Types].xml
├── _rels
├── docProps
│   ├── app.xml
│   └── core.xml
└── word
    ├── _rels
    │   ├── document.xml.rels
    │   └── footnotes.xml.rels
    ├── document.xml
    ├── fontTable.xml
    ├── footnotes.xml
    ├── media
    ├── numbering.xml
    ├── settings.xml
    ├── styles.xml
    ├── theme
    │   └── theme1.xml
    └── webSettings.xml
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;可以看出，大多数都是 XML 文件。我们主要关注其中三个文件：&lt;code class=&quot;highlighter-rouge&quot;&gt;word/document.xml&lt;/code&gt;，&lt;code class=&quot;highlighter-rouge&quot;&gt;word/styles.xml&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;word/fontTable.xml&lt;/code&gt;。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;document.xml&lt;/code&gt;：&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件的内容&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;styles.xml&lt;/code&gt;：&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件的样式&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fontTable.xml&lt;/code&gt;：&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件用到的的字体&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件基本上做到了表现和内容分离。&lt;code class=&quot;highlighter-rouge&quot;&gt;document.xml&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;styles.xml&lt;/code&gt; 可以比作 Web 中的 HTML 和 CSS。定制样式时，我们基本上不用修改内容，也就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;document.xml&lt;/code&gt; 文件。下面着重介绍 &lt;code class=&quot;highlighter-rouge&quot;&gt;styles.xml&lt;/code&gt; 文件。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;styles.xml&lt;/code&gt; 文件的作用相当于 Web 中的 CSS，只不过这是 XML 文件，而且也不使用 CSS 规则定义样式。下面是一个样式示例：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;w:style w:styleId=&quot;BodyText&quot; w:type=&quot;paragraph&quot;&amp;gt;
    &amp;lt;w:name w:val=&quot;Body Text&quot;/&amp;gt;
    &amp;lt;w:basedOn w:val=&quot;Normal&quot;/&amp;gt;
    &amp;lt;w:link w:val=&quot;BodyTextChar&quot;/&amp;gt;
    &amp;lt;w:pPr&amp;gt;
        &amp;lt;w:spacing w:after=&quot;180&quot; w:before=&quot;180&quot;/&amp;gt;
    &amp;lt;/w:pPr&amp;gt;
    &amp;lt;w:rPr&amp;gt;
        &amp;lt;w:rFonts w:ascii=&quot;Arial&quot; w:cstheme=&quot;majorBidi&quot; w:eastAsia=&quot;黑体&quot; w:hAnsiTheme=&quot;majorHAnsi&quot;/&amp;gt;
        &amp;lt;w:sz w:val=&quot;36&quot;/&amp;gt;
    &amp;lt;/w:rPr&amp;gt;
&amp;lt;/w:style&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;w:styleId&lt;/code&gt; 属性的值是内部 ID，&lt;code class=&quot;highlighter-rouge&quot;&gt;document.xml&lt;/code&gt; 文件中的结构需要什么样式，就引用这个 ID 的值，就像是 CSS 中的选择符一样。&lt;code class=&quot;highlighter-rouge&quot;&gt;w:type&lt;/code&gt; 属性是样式的类型，一般只会用到 &lt;code class=&quot;highlighter-rouge&quot;&gt;paragraph&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;character&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;table&lt;/code&gt;。&lt;code class=&quot;highlighter-rouge&quot;&gt;w:name&lt;/code&gt; 元素中 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:val&lt;/code&gt; 属性的值是这个样式在 GUI 应用（Word，Pages 或 OpenOffice 等）中显示的名称。&lt;code class=&quot;highlighter-rouge&quot;&gt;w:basedOn&lt;/code&gt; 元素中 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:val&lt;/code&gt; 的值是这个样式继承的其他样式 ID；这个元素很重要，用于实现块级元素的样式继承。&lt;code class=&quot;highlighter-rouge&quot;&gt;w:link&lt;/code&gt; 元素中 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:val&lt;/code&gt; 的值也是这个样式继承的其他样式 ID，不过这个元素继承的是行内元素的样式。&lt;code class=&quot;highlighter-rouge&quot;&gt;w:pPr&lt;/code&gt; 元素设定的是段落样式，其中 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:spacing&lt;/code&gt; 元素用于设置段前和段后距离，单位是二十分之一英寸。&lt;code class=&quot;highlighter-rouge&quot;&gt;w:rPr&lt;/code&gt; 元素用于设置段落中行内元素的样式，其中 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:rFonts&lt;/code&gt; 元素用于设置字体（可以分别设置中西文字体），&lt;code class=&quot;highlighter-rouge&quot;&gt;w:sz&lt;/code&gt; 元素用于设置字号，单位是二分之一点（pt）。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件的样式规则乍看起来很复杂，其实也比较易于理解。我想真正让人觉得难懂的，是 XML 结构。虽然如此，我还是不建议直接手写样式。你可以先在 Word 中通过 GUI 创建样式，然后解压 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件，修改样式，或者把样式复制出来，方便以后重用。&lt;/p&gt;

&lt;p&gt;另一个可能需要修改的文件是 &lt;code class=&quot;highlighter-rouge&quot;&gt;fontTable.xml&lt;/code&gt;。这个文件定义 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件中用到的所有字体。下面是一个字体定义示例：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;w:font w:name=&quot;宋体&quot;&amp;gt;
    &amp;lt;w:altName w:val=&quot;SimSun&quot;/&amp;gt;
    &amp;lt;w:panose1 w:val=&quot;02010600030101010101&quot;/&amp;gt;
    &amp;lt;w:charset w:val=&quot;86&quot;/&amp;gt;
    &amp;lt;w:family w:val=&quot;auto&quot;/&amp;gt;
    &amp;lt;w:pitch w:val=&quot;variable&quot;/&amp;gt;
    &amp;lt;w:sig w:csb0=&quot;00040001&quot; w:csb1=&quot;00000000&quot; w:usb0=&quot;00000003&quot; w:usb1=&quot;080E0000&quot; w:usb2=&quot;00000010&quot; w:usb3=&quot;00000000&quot;/&amp;gt;
&amp;lt;/w:font&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;字体的定义看起来比样式简单，其实有很多属性的值是使用某种机制生成的，例如 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:panose1&lt;/code&gt; 元素的 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:val&lt;/code&gt; 属性，因此不要自己动手编写。同样，也是先在 Word 中定义好，然后将其复制出来。&lt;/p&gt;

&lt;h2&gt;定制方式&lt;/h2&gt;

&lt;p&gt;如果只需要定制 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件的样式，可以准备好 &lt;code class=&quot;highlighter-rouge&quot;&gt;styles.xml&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;fontTable.xml&lt;/code&gt; 文件，然后替换掉 Pandoc 生成的 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件中的这两个文件。例如，在命令行中可以执行下述命令替换：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;zip -r sample.docx word/styles.xml word/fontTable.xml
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下面举个定义样式的例子。在一本书中，每一章一般都新起一页，而不是和前一章的内容连在一起。也就是说，新的一章要换页。在 OOXML 中，换页主要由两种方式，这里我们要使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:pageBreakBefore&lt;/code&gt; 元素。后面再介绍另一种方式。按照 Pandoc 的生成方式，一章的标题一般是一级标题，所以我们可以在一级标题的样式中加入 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:pageBreakBefore&lt;/code&gt; 元素，在一级标题之前换页，如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;w:style w:styleId=&quot;Heading1&quot; w:type=&quot;paragraph&quot;&amp;gt;
    &amp;lt;w:name w:val=&quot;Heading 1&quot;/&amp;gt;
    &amp;lt;w:pPr&amp;gt;
      &amp;lt;w:pageBreakBefore/&amp;gt;
    &amp;lt;/w:pPr&amp;gt;
&amp;lt;/w:style&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;加入这个样式后，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件的每个一级标题之前都会换页。&lt;/p&gt;

&lt;h2&gt;过滤器&lt;/h2&gt;

&lt;p&gt;有时我们需要手动强制换页，这时该怎么做呢？答案是使用&lt;a href=&quot;http://pandoc.org/scripting.html&quot; title=&quot;过滤器&quot;&gt;过滤器&lt;/a&gt;。Pandoc 提供了强大的过滤器机制，方便使用者定制。Pandoc 转换文件的过程如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        pandoc         filter         pandoc
source --------&amp;gt; JSON --------&amp;gt; JSON --------&amp;gt; target
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;因此，我们可以使用过滤器修改 Pandoc 生成的 JSON 中间格式。Pandoc 的过滤器有 &lt;a href=&quot;http://github.com/jgm/pandocfilters&quot; title=&quot;Python API&quot;&gt;Python API&lt;/a&gt;、&lt;a href=&quot;https://github.com/vinai/pandocfilters-php&quot; title=&quot;PHP API&quot;&gt;PHP API&lt;/a&gt; 和 &lt;a href=&quot;https://github.com/mvhenderson/pandoc-filter-node&quot; title=&quot;Node/JavaScript API&quot;&gt;Node/JavaScript API&lt;/a&gt;。不过我对这些语言都不熟悉，所以自己写了一个“简陋”的 &lt;a href=&quot;https://gist.github.com/AndorChen/a07c591fed685fb7a80c&quot; title=&quot;Ruby API&quot;&gt;Ruby API&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;下面说明怎么使用过滤器实现手动换页。假设我们在 Markdown 文件中输入 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;!--PAGEBREAK--&amp;gt;&lt;/code&gt; 时是想换页。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/env ruby&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;pandocfilter&#39;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;RawBlock&#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&amp;lt;!--PAGEBREAK--&amp;gt;&#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;xml&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sx&quot;&gt;%(&amp;lt;w:p&amp;gt;&amp;lt;w:r&amp;gt;&amp;lt;w:br w:type=&quot;page&quot;/&amp;gt;&amp;lt;/w:r&amp;gt;&amp;lt;/w:p&amp;gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PandocFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;raw_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;openxml&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xml&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;PandocFilter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;process&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在这个过滤器中，我们把 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;!--PAGEBREAK--&amp;gt;&lt;/code&gt; 替换成 OOXML 格式的元素（&lt;code class=&quot;highlighter-rouge&quot;&gt;raw_block&lt;/code&gt; 方法创建的是 &lt;a href=&quot;http://hackage.haskell.org/package/pandoc-types-1.12.4.3/docs/Text-Pandoc-Definition.html#v:RawBlock&quot; title=&quot;&amp;lt;code class=&amp;quot;highlighter-rouge&amp;quot;&amp;gt;RawBlock&amp;lt;/code&amp;gt; 元素&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;RawBlock&lt;/code&gt; 元素&lt;/a&gt;）。这个元素表示一个段落，但没有内容。换页的关键是 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:br&lt;/code&gt; 元素，当 &lt;code class=&quot;highlighter-rouge&quot;&gt;w:type&lt;/code&gt; 属性的值为 &lt;code class=&quot;highlighter-rouge&quot;&gt;page&lt;/code&gt; 时表示换页。&lt;/p&gt;

&lt;p&gt;除了前面举的几个例子之外，我还做了其他定制，这里就不再一一介绍了。&lt;/p&gt;

&lt;h2&gt;总结&lt;/h2&gt;

&lt;p&gt;虽然我现在基本上实现了所需的 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 文件样式，但使用 Markdown + Pandoc 的方式还是让我觉得别扭。Pandoc 虽然很强大，相对也易于定制，但是 Markdown 有其局限性。Markdown 是为了在 Web 中快速书写而创造的，不是为了写书稿。写书稿首选当然是 &lt;a href=&quot;http://www.methods.co.nz/asciidoc/&quot; title=&quot;AsciiDoc&quot;&gt;AsciiDoc&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;如果有时间的话，我会开发一个 AsciiDoc 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;docx&lt;/code&gt; 的转换程序。当然，这是一个愿景，要知道，&lt;a href=&quot;http://www.ecma-international.org/publications/standards/Ecma-376.htm&quot; title=&quot;OOXML 规范&quot;&gt;OOXML 规范&lt;/a&gt;（ECMA-376）可是超过五千页啊。&lt;/p&gt;
</description>
        <pubDate>Mon, 01 Jun 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/06/docx-hack-guide.html</link>
        <guid isPermaLink="true">http://about.ac/2015/06/docx-hack-guide.html</guid>
        
        <category>Dev</category>
        
        
      </item>
    
      <item>
        <title>翻译时使用的应用</title>
        <description>&lt;p&gt;我的工作电脑是台 MacBook Pro。因此，本文提到的都是 OS X 系统中的应用。本文介绍我在翻译时使用的应用。我选择应用时会使用以下标准：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;首选系统内置的应用&lt;/li&gt;
  &lt;li&gt;优先选择免费开源的工具&lt;/li&gt;
  &lt;li&gt;使用收费软件的精简免费版&lt;/li&gt;
  &lt;li&gt;迫不得已，再使用收费软件&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Terminal.app (bash)&lt;/h2&gt;

&lt;p&gt;我的翻译流程基本上是都在命令行中完成，包括创建项目、推送 Git 仓库和提取 PDF 文件中的图像等。我习惯使用系统自带的终端，而且使用的 shell 是 bash。对日常操作来说，bash 足够了，因此我没有使用功能更强的 &lt;a href=&quot;http://www.zsh.org&quot; title=&quot;zsh 的网站&quot;&gt;zsh&lt;/a&gt; 或 &lt;a href=&quot;http://tmux.sourceforge.net/&quot; title=&quot;tmux 项目的网站&quot;&gt;tmux&lt;/a&gt; 等。&lt;/p&gt;

&lt;h2&gt;Git&lt;/h2&gt;

&lt;p&gt;我在命令行中最常执行的是 Git 相关的操作，因为我会为每个翻译项目创建 Git 仓库，并在远程仓库（BitBucket）中备份。我的 Git 使用 &lt;a href=&quot;http://brew.sh&quot; title=&quot;homebrew 的网站&quot;&gt;homebrew&lt;/a&gt; 管理和更新。&lt;/p&gt;

&lt;h2&gt;Sublime Text&lt;/h2&gt;

&lt;p&gt;翻译时，我都使用纯文本格式撰写译稿，最常使用 &lt;a href=&quot;http://daringfireball.net/projects/markdown/&quot; title=&quot;Markdown 的网站&quot;&gt;Markdown&lt;/a&gt;，但是如果可能，我会尽量使用 &lt;a href=&quot;http://www.methods.co.nz/asciidoc/&quot; title=&quot;AsciiDoc 的网站&quot;&gt;AsciiDoc&lt;/a&gt;（转换时使用 &lt;a href=&quot;http://asciidoctor.org&quot; title=&quot;Asciidoctor 的网站&quot;&gt;Asciidoctor&lt;/a&gt;）。&lt;/p&gt;

&lt;p&gt;既然是纯文本，一个简单易用的文本编辑器就足够了。我最常使用的文本编辑器是 &lt;a href=&quot;www.sublimetext.com&quot; title=&quot;Sublime Text&quot;&gt;Sublime Text&lt;/a&gt;。我从不使用专门的 Markdown 编辑器，例如 &lt;a href=&quot;http://25.io/mou/&quot; title=&quot;Mou 的网站&quot;&gt;Mou&lt;/a&gt; 或 &lt;a href=&quot;http://marked2app.com&quot; title=&quot;Marked 的网站&quot;&gt;Marked&lt;/a&gt; 等。因为专门的 Markdown 编辑器不支持某些出版社特有的句法，而且我觉得自己并不需要这些应用提供的功能（比如实时预览），所以能不多安装一个应用就不安装。&lt;/p&gt;

&lt;h2&gt;Preview.app&lt;/h2&gt;

&lt;p&gt;很多时候，出版社只会提供原书的 PDF 文档，所以需要一个查看 PDF 的应用。一般情况下我会使用系统内置的 Preview.app，如果需要同时打开多个 PDF 文件（需要标签页功能），我会使用 &lt;a href=&quot;https://itunes.apple.com/us/app/pdf-reader-x/id684812309&quot; title=&quot;购买 PDF Reader X&quot;&gt;PDF Reader X&lt;/a&gt;。&lt;/p&gt;

&lt;h2&gt;xpdf (pdfimages)&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.foolabs.com/xpdf/&quot; title=&quot;xpdf 的网站&quot;&gt;xpdf&lt;/a&gt; 包含多个用于处理 PDF 文件的命令行工具：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pdfinfo&lt;/code&gt;：查看 PDF 的元信息&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pdffonts&lt;/code&gt;：查看 PDF 文件中使用的字体&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pdfdetach&lt;/code&gt;：提取 PDF 文件的附件&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pdftoppm&lt;/code&gt;：把 PDF 文件转换成 &lt;code class=&quot;highlighter-rouge&quot;&gt;ppm&lt;/code&gt; 格式的图像&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pdfimages&lt;/code&gt;：提取 PDF 文件中的图像&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;我最常使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;pdfimages&lt;/code&gt;，把 PDF 文件中的图像提取出来（因为多数时候，出版社只会提供原书的 PDF 文档，不会提供原始文稿和图像）。Adobe Acrobat 也可以提取图像，不过这是收费应用。注意，&lt;code class=&quot;highlighter-rouge&quot;&gt;pdfimages&lt;/code&gt; 提取出来的图像是 &lt;code class=&quot;highlighter-rouge&quot;&gt;ppm&lt;/code&gt; 格式，需要转换成常见的图像格式（例如 &lt;code class=&quot;highlighter-rouge&quot;&gt;jpg&lt;/code&gt; 或 &lt;code class=&quot;highlighter-rouge&quot;&gt;png&lt;/code&gt;）。&lt;/p&gt;

&lt;h2&gt;ToyViewer.app&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://itunes.apple.com/en/app/toyviewer/id414298354&quot; title=&quot;购买 ToyViewer&quot;&gt;ToyViewer&lt;/a&gt; 是免费的图像查看应用，支持的格式很多。我主要使用这个应用把 &lt;code class=&quot;highlighter-rouge&quot;&gt;pdfimages&lt;/code&gt; 从 PDF 文件中提取出来的 &lt;code class=&quot;highlighter-rouge&quot;&gt;ppm&lt;/code&gt; 格式图像转换成 &lt;code class=&quot;highlighter-rouge&quot;&gt;jpg&lt;/code&gt; 格式。&lt;/p&gt;

&lt;p&gt;如果选择命令行工具，可以使用 &lt;a href=&quot;http://www.imagemagick.org/&quot; title=&quot;ImageMagick 的网站&quot;&gt;ImageMagick&lt;/a&gt;。不过我在使用 ImageMagick 时一直遇到问题，所以暂且使用 GUI 应用代替。有时间再解决这个问题。&lt;/p&gt;

&lt;h2&gt;pandoc&lt;/h2&gt;

&lt;p&gt;我一直没用到 &lt;a href=&quot;http://pandoc.org/&quot; title=&quot;pandoc 的网站&quot;&gt;pandoc&lt;/a&gt;，直到最近，一个出版社要求提供 &lt;code class=&quot;highlighter-rouge&quot;&gt;doc&lt;/code&gt; 文档，我才第一次使用 pandoc。我之所以不使用这个工具，其中一个原因是，这个工具是使用 &lt;a href=&quot;https://www.haskell.org/&quot; title=&quot;Haskell 语言的网站&quot;&gt;Haskell 语言&lt;/a&gt;开发的。&lt;/p&gt;

&lt;p&gt;pandoc 是个命令行工具，作用是在 Markdown 和多种格式之间转换，其中就包含把 Markdown 转换成 &lt;code class=&quot;highlighter-rouge&quot;&gt;doc&lt;/code&gt; 格式。因为 pandoc 是使用 Haskell 语言开发的，虽然提供了很多其他语言的 API，但扩展起来依然很难。目前，我只使用 pandoc 内置的格式创建 &lt;code class=&quot;highlighter-rouge&quot;&gt;doc&lt;/code&gt; 文档。&lt;/p&gt;

&lt;h2&gt;persie&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/AndorChen/persie&quot; title=&quot;persie 在 GitHub 中的仓库&quot;&gt;persie&lt;/a&gt; 是我自己开发的一个命令行工具，用于把 AsciiDoc 格式编写的文稿转换成电子书。persie 使用以下三个工具生成电子书：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.princexml.com/&quot; title=&quot;PrinceXML 的网站&quot;&gt;PrinceXML&lt;/a&gt;：生成 PDF 格式电子书。PrinceXML 最大的优势是，使用 CSS 定义 PDF 文件的格式。这是个收费软件，不过有免费试用版，而且可以终生使用（不过会在 PDF 文件的第一页加一个 LOGO，但很容易去掉）。&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://rubygems.org/gems/gepub&quot; title=&quot;gepub&quot;&gt;gepub&lt;/a&gt;：生成 ePub 格式电子书。这是个 Ruby gem。&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.amazon.com/gp/feature.html?docId=1000765211&quot; title=&quot;KindleGen 的网站&quot;&gt;KindleGen&lt;/a&gt;：生成 mobi 格式电子书。这是 Amazon 提供的工具，部分国家或地区无法下载（需要科学上网）。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;我翻译的《&lt;a href=&quot;http://railstutorial-china.org&quot; title=&quot;Ruby on Rails 教程的网站&quot;&gt;Ruby on Rails 教程&lt;/a&gt;》和自己写的《&lt;a href=&quot;https://selfstore.io/products/184/&quot; title=&quot;购买 Jekyll 小书&quot;&gt;Jekyll 小书&lt;/a&gt;》都是使用 persie 制作的电子书。&lt;/p&gt;

&lt;h2&gt;Dictionary.app / Youdao.app&lt;/h2&gt;

&lt;p&gt;翻译时免不了要查字典，我使用的字典类应用有两个：Dictionary.app 和 Youdao.app。Dictionary 主要用于管理术语，我会把每本书中用到的术语制成词典，这样方便以后查找。除此之外，我还把&lt;a href=&quot;http://www.microsoft.com/Language/zh-cn/Terminology.aspx&quot; title=&quot;下载微软的术语库&quot;&gt;微软的术语词库&lt;/a&gt;制成了词典。&lt;/p&gt;

&lt;p&gt;制作词典的方法有两种：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;使用 Auxiliary Tools。这是 Apple 提供的命令行工具，旧版 OS X 中内置，新版系统要到开发者网站中下载。&lt;/li&gt;
  &lt;li&gt;使用 &lt;a href=&quot;https://code.google.com/p/mac-dictionary-kit/&quot; title=&quot;Mac Dictionary Kit&quot;&gt;DictUnifier.app&lt;/a&gt;。这是 GUI 应用，用于转换 stardict 的词典，以便在 Dictionary.app 中使用。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Sparrow.app&lt;/h2&gt;

&lt;p&gt;Sparrow 被 Google 收购后虽然销声匿迹了，但我觉得它仍然是 OS X 中最好用的邮件客户端。&lt;/p&gt;

&lt;p&gt;翻译时经常需要与出版社或原作者联系，因此有必要使用一个顺手的邮件客户端。&lt;/p&gt;

</description>
        <pubDate>Sun, 10 May 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/05/apps-for-translator.html</link>
        <guid isPermaLink="true">http://about.ac/2015/05/apps-for-translator.html</guid>
        
        <category>Translation</category>
        
        
      </item>
    
      <item>
        <title>第一个 Mac APP</title>
        <description>&lt;p&gt;在译完一本书之后，我习惯休息几天，清空对上一本书的记忆，为翻译下一本书做好准备。昨天提交了过去两个月翻译的一本书，本准备好好休息一下，可以今早六点醒了之后就睡不着了。在网上闲逛了大半天，下午决定为自己的一个需求开发一个 Mac APP。&lt;/p&gt;

&lt;p&gt;其实这个 APP 计划很久了，只是一直没动手。我给出版社翻译的书，出版之后出版社会赠送几本（一般是五本）样书给我，我自己会留一本作纪念，剩下则免费送给网友（比如&lt;a href=&quot;https://v2ex.com/t/149111&quot; title=&quot;Python 网络编程攻略&quot;&gt;这本&lt;/a&gt;和&lt;a href=&quot;https://v2ex.com/t/155524&quot; title=&quot;Flask Web 开发&quot;&gt;这本&lt;/a&gt;）。如果你看了这两个送书的帖子会发现，我之前使用的赠送规则是有缺陷的：一本的规则是先到先得，一本的规则是根据彩票开奖结果匹配楼层数。这两种赠送规则都会打击用户的参与积极性，要不来晚了就没了，要不只有一定范围内的楼层有效。所以我想开发的就是一个简单的“抽奖”程序。&lt;/p&gt;

&lt;p&gt;这类程序实现起来不难，我之前用过 JavaScript 实现的“抽奖”程序。不过因为我最近对 Mac APP 开发比较感兴趣，所以决定自己动手写一个类似的程序。我规划的 UI 及操作流程是这样的：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;打开应用后，界面中显示一个标签和一个按钮&lt;/li&gt;
  &lt;li&gt;标签用于显示“抽奖”的主题&lt;/li&gt;
  &lt;li&gt;点击按钮后开始抽奖&lt;/li&gt;
  &lt;li&gt;抽奖结束后弹出一个窗口，显示抽奖结果&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;在编写样板代码阶段，一切顺利，毕竟样板代码写了很多次，而且基本都一样。可是实现具体功能时却遇到了几个问题。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;如何从数组中随机选取元素&lt;/li&gt;
  &lt;li&gt;如何实现延时操作&lt;/li&gt;
  &lt;li&gt;如何弹出窗口&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;随机选取元素涉及到生成随机数，要使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;arc4random_uniform()&lt;/code&gt; 函数，还要做些类型转换。这一点我在以前看过的 iOS 视频教程中就知道了，可是记不住该怎么转换类型。熟悉 Ruby 语言的开发者大概都知道，在 Ruby 中 &lt;code class=&quot;highlighter-rouge&quot;&gt;Array&lt;/code&gt; 类有个 &lt;code class=&quot;highlighter-rouge&quot;&gt;#sample&lt;/code&gt; 方法，用于从数组中随机选取元素。如果在 Swift 中也能这么做就好了。这时我想起了之前在 GitHub 中关注的一个项目——&lt;a href=&quot;https://github.com/pNre/ExSwift&quot; title=&quot;ExSwift&quot;&gt;ExSwift&lt;/a&gt;。ExSwift 对 Swift 的原生类型做了很多扩展，实现了大量 Ruby 和 Rails 中的实用方法。很巧，ExSwift 也在 &lt;code class=&quot;highlighter-rouge&quot;&gt;Array&lt;/code&gt; 类上实现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;sample()&lt;/code&gt; 方法（&lt;a href=&quot;https://github.com/pNre/ExSwift/blob/f1411fc6320a053afca00ef975648c975a30ca75/ExSwift/Array.swift#L407-420&quot; title=&quot;代码&quot;&gt;代码&lt;/a&gt;）。这样第一个问题解决了——找到了从数组中随机选取元素的方式。&lt;/p&gt;

&lt;p&gt;下面是第二个问题。我之所以想实现延迟，是因为这个应用的功能太简单，运行的很快，就像没运行一样。为了让它看起来在背后做了很多事情，我想让结果等待一段时间再出现（在弹出窗口中）。可是怎么实现延迟呢？我首先想到的是“sleep”。可是 &lt;code class=&quot;highlighter-rouge&quot;&gt;sleep()&lt;/code&gt; 函数和 &lt;code class=&quot;highlighter-rouge&quot;&gt;NSThread.
sleepForTimeInterval(_:)&lt;/code&gt; 方法都会导致 UI 无响应，就像假死一样。经过一番搜索之后，我知道这种效果应该使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;dispatch_after(_:_:_:)&lt;/code&gt; 函数实现。现在还剩最后一个问题了。&lt;/p&gt;

&lt;p&gt;我前面一直在用“弹出”这个词，因为我以为我要实现的效果是“pop-up”。可是搜了好久都没找到相关的 API，最后才发现应该使用“提醒”（&lt;code class=&quot;highlighter-rouge&quot;&gt;NSAlert&lt;/code&gt;）。不过在使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;beginSheetModalForWindow(_:completionHandler:)&lt;/code&gt; 方法时，处理回调用了很长时间。这体现了我对 Swift 语言（尤其是闭包）的理解还很浅显。&lt;/p&gt;

&lt;p&gt;大概用了三个小时，期间不断地搜索、查 API 文档和纠错，最终这个应用总算实现了规划的功能，顺利运行起来了。&lt;/p&gt;

&lt;figure class=&quot;text-center&quot;&gt;
&lt;img src=&quot;/assets/images/figures/LuckyMan.png&quot; alt=&quot;LuckyMan&quot; /&gt;
&lt;figcaption&gt;LuckyMan&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;这是我自己规划功能、自己动手开发的第一个 Mac APP，因此特写此文，以作纪念。在开发的过程中，我学到了：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Swift 语言是基础&lt;/li&gt;
  &lt;li&gt;大部分工作是要熟悉 Cocoa API&lt;/li&gt;
  &lt;li&gt;Dash 买得值&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;我想，再过一段时间这个应用就能派上用场了。&lt;/p&gt;
</description>
        <pubDate>Thu, 07 May 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/05/first-mac-app.html</link>
        <guid isPermaLink="true">http://about.ac/2015/05/first-mac-app.html</guid>
        
        <category>Dev</category>
        
        
      </item>
    
      <item>
        <title>O&#39;Reilly 电子书在多看中没有目录的修正方法</title>
        <description>&lt;p&gt;我平时看电子书，尤其是 ePub 格式的电子书，喜欢使用多看，包括我的 Kindle，也刷成了多看的系统。我看的电子书中相当一部分是 O’Reilly 出版社的。但在多看的系统中，O’Reilly 出版社的电子书都没有目录。如果只有一两本是这种情况，有可能是 O’Reilly 的问题。可是，我接触到的所有O’Reilly 出版社的电子书都是如此，所以我猜想可能是多看系统的问题。&lt;/p&gt;

&lt;p&gt;鉴于此，我在其他几个 ePub 阅读器中做了测试，包括 iBooks（Mac 和 iPhone）和 Adobe Digital Editions。在这些阅读器中，O’Reilly 出版社的电子书都能正确显示目录。我还使用 &lt;a href=&quot;https://github.com/idpf/epubcheck&quot; title=&quot;epubcheck&quot;&gt;epubcheck&lt;/a&gt; 对 O’Reilly 的电子书做了验证，结果是，完全没问题。&lt;/p&gt;

&lt;p&gt;今天，我仔细研究了一下，发现在 O’Reilly 的电子书中，&lt;a href=&quot;http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1&quot; title=&quot;&amp;lt;code class=&amp;quot;highlighter-rouge&amp;quot;&amp;gt;toc.ncx&amp;lt;/code&amp;gt; 文件&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;toc.ncx&lt;/code&gt; 文件&lt;/a&gt;中“缺少”一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;meta&lt;/code&gt; 元素：&lt;a href=&quot;http://www.niso.org/workrooms/daisy/Z39-86-2005.html#li_406&quot; title=&quot;&amp;lt;code class=&amp;quot;highlighter-rouge&amp;quot;&amp;gt;dtb:depth&amp;lt;/code&amp;gt;&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dtb:depth&lt;/code&gt;&lt;/a&gt;。我把”缺少“放在了引号中，因为没有这个元素，epubcheck 并没有报错，说明 ePub 规范并不强制要求必须有这个元素。而且，虽然没有这个元素，很多其他 ePub 阅读器都能正确解析目录。所以，多看没有显示目录的原因，我想应该是兼容性不够强。&lt;/p&gt;

&lt;p&gt;我在 &lt;code class=&quot;highlighter-rouge&quot;&gt;toc.ncx&lt;/code&gt; 文件中加上了这个 &lt;code class=&quot;highlighter-rouge&quot;&gt;meta&lt;/code&gt; 元素：&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;meta name=&quot;dtb:depth&quot; content=&quot;1&quot;/&amp;gt;&lt;/code&gt;，然后重新打包，在多个 ePub 阅读器中做了测试，包括多看系统，都能正确显示目录。而且，我也使用 epubcheck 做了验证，没有错误。&lt;/p&gt;

&lt;p&gt;如果你也在使用多看系统，阅读O’Reilly 出版社的电子书觉得没有目录不方便，可以按照下述方法修正：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;使用解压缩软件解压 ePub 文件（可能要先把 ePub 文件的扩展名改为 &lt;code class=&quot;highlighter-rouge&quot;&gt;.zip&lt;/code&gt;）;&lt;/li&gt;
  &lt;li&gt;打开解压得到的文件夹，在文本编辑器中打开 &lt;code class=&quot;highlighter-rouge&quot;&gt;OEBPS&lt;/code&gt; 子文件夹中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;toc.ncx&lt;/code&gt; 文件；&lt;/li&gt;
  &lt;li&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;head&lt;/code&gt; 元素中加上这个 &lt;code class=&quot;highlighter-rouge&quot;&gt;meta&lt;/code&gt; 元素：&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;meta name=&quot;dtb:depth&quot; content=&quot;1&quot;/&amp;gt;&lt;/code&gt;；&lt;/li&gt;
  &lt;li&gt;最后，重新打包整个文件夹。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;重新打包时要注意两个问题：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一定要先打包 &lt;code class=&quot;highlighter-rouge&quot;&gt;mimetype&lt;/code&gt; 这个文件；&lt;/li&gt;
  &lt;li&gt;而且，这个文件的压缩率必须为 0%。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果你觉得每次都手动修正很麻烦，可以使用我写的 Rake 任务，如下所示。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;fileutils&#39;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Usage: rake duokanify file=path/to/sample.epub&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;desc&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Adds dtb:depth to ncx file in an ePub&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:duokanify&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;file&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ERROR: Please provide the ePub file path!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;exit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;file&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;end_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;.epub&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ERROR: The file you provided is not an ePub!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;exit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expand_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;file&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exist?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ERROR: The file you provided is not exists!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;exit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Unzipping....&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;basename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;.epub&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;unzip &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;file&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -d &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Normalize....&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ncx_file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;OEBPS&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;toc.ncx&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exist?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ncx_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Info: The ePub has no ncx file, needless to normalize.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;exit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ncx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ncx_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;r+&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# puts content.inspect&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/meta=&quot;dtb:depth&quot;/i&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Info: The ePub already set dtb:depth, needless to normalize.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;exit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;parts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;&amp;lt;/head&amp;gt;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;&amp;lt;meta name=&quot;dtb:depth&quot; content=&quot;1&quot;/&amp;gt;&#39;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rewind&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;&amp;lt;/head&amp;gt;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Rezipping....&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;normalized_file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;basename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-normalized.epub&quot;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;FileUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;zip -0 -X &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normalized_file&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; mimetype&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;zip -9 -r &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normalized_file&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; META-INF OEBPS&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;FileUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;normalized_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pwd&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Cleanning....&#39;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;FileUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rm_rf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:secure&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Done&#39;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Normalized ePub path: ./&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normalized_file&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这个 Rake 任务的使用方法是：在命令行中执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;rake duokanify file=path/to/sample.epub&lt;/code&gt;。执行这个命令后会得到一个名为 &lt;code class=&quot;highlighter-rouge&quot;&gt;sample-normalized.epub&lt;/code&gt; 的文件，然后再把这个文件上传到多看中即可。&lt;/p&gt;

&lt;p&gt;水平有限，我的这个 Rake 任务写得比较蹩脚，如果你觉得有可以改进的地方（有很多），请访问&lt;a href=&quot;https://gist.github.com/AndorChen/8ebfc5821ceac8884416&quot; title=&quot;这个 Gist&quot;&gt;这个 Gist&lt;/a&gt;，给我留言。这个 Rake 任务的最新版会在这个 Gist 中更新。&lt;/p&gt;
</description>
        <pubDate>Mon, 06 Apr 2015 00:00:00 +0000</pubDate>
        <link>http://about.ac/2015/04/duokanify.html</link>
        <guid isPermaLink="true">http://about.ac/2015/04/duokanify.html</guid>
        
        <category>eBook</category>
        
        
      </item>
    
  </channel>
</rss>
