<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>第一个 Mac APP - Andor Chen</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="renderer" content="webkit" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="description" content="安道的个人网站" />
  <meta name="author" content="安道" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link type="application/atom+xml" rel="alternate" href="https://about.ac/feed.xml" title="Andor Chen" />
  <link rel="stylesheet" href="/_bridgetown/static/index.EAB43WFI.css" />
  <script src="/_bridgetown/static/index.3QSIHARC.js" defer></script>
  
</head>
<body class="bg-dracula-darker text-dracula-light">

<div class="px-6 py-8 md:px-16 lg:px-24 lg:py-16">
  
  <header class="max-w-prose mb-12">
    <div class="flex flex-row">
      <div class="basis-1/6 flex-auto"><a href="/" title="安道"><img src="/assets/images/painting.png" alt="Andor's Avatar" class="rounded-full w-32" /></a></div>
      <div class="basis-5/6 flex-auto self-center"><span class="pl-8 text-4xl font-medium"><a href="/" title="安道">安道</a></span></div>
    </div>
  </header>

  <main>

<div class="mb-4">
  <a href="/" title="首页">首页</a> // <a href="/archive/" title="文章归档">文章归档</a>
</div>


<article class="prose prose-invert">
  <header>
    <h1 class="text-dracula-orange">第一个 Mac APP</h1>
    <p>（发布于 2015 年 5 月 7 日）</p>
  </header>

  <main>
    <p>在译完一本书之后，我习惯休息几天，清空对上一本书的记忆，为翻译下一本书做好准备。昨天提交了过去两个月翻译的一本书，本准备好好休息一下，可以今早六点醒了之后就睡不着了。在网上闲逛了大半天，下午决定为自己的一个需求开发一个 Mac APP。</p>

<p>其实这个 APP 计划很久了，只是一直没动手。我给出版社翻译的书，出版之后出版社会赠送几本（一般是五本）样书给我，我自己会留一本作纪念，剩下则免费送给网友（比如<a href="https://v2ex.com/t/149111" title="Python 网络编程攻略">这本</a>和<a href="https://v2ex.com/t/155524" title="Flask Web 开发">这本</a>）。如果你看了这两个送书的帖子会发现，我之前使用的赠送规则是有缺陷的：一本的规则是先到先得，一本的规则是根据彩票开奖结果匹配楼层数。这两种赠送规则都会打击用户的参与积极性，要不来晚了就没了，要不只有一定范围内的楼层有效。所以我想开发的就是一个简单的“抽奖”程序。</p>

<p>这类程序实现起来不难，我之前用过 JavaScript 实现的“抽奖”程序。不过因为我最近对 Mac APP 开发比较感兴趣，所以决定自己动手写一个类似的程序。我规划的 UI 及操作流程是这样的：</p>

<ul>
  <li>打开应用后，界面中显示一个标签和一个按钮</li>
  <li>标签用于显示“抽奖”的主题</li>
  <li>点击按钮后开始抽奖</li>
  <li>抽奖结束后弹出一个窗口，显示抽奖结果</li>
</ul>

<p>在编写样板代码阶段，一切顺利，毕竟样板代码写了很多次，而且基本都一样。可是实现具体功能时却遇到了几个问题。</p>

<ul>
  <li>如何从数组中随机选取元素</li>
  <li>如何实现延时操作</li>
  <li>如何弹出窗口</li>
</ul>

<p>随机选取元素涉及到生成随机数，要使用 <code class="highlighter-rouge">arc4random_uniform()</code> 函数，还要做些类型转换。这一点我在以前看过的 iOS 视频教程中就知道了，可是记不住该怎么转换类型。熟悉 Ruby 语言的开发者大概都知道，在 Ruby 中 <code class="highlighter-rouge">Array</code> 类有个 <code class="highlighter-rouge">#sample</code> 方法，用于从数组中随机选取元素。如果在 Swift 中也能这么做就好了。这时我想起了之前在 GitHub 中关注的一个项目——<a href="https://github.com/pNre/ExSwift">ExSwift</a>。ExSwift 对 Swift 的原生类型做了很多扩展，实现了大量 Ruby 和 Rails 中的实用方法。很巧，ExSwift 也在 <code class="highlighter-rouge">Array</code> 类上实现了 <code class="highlighter-rouge">sample()</code> 方法（<a href="https://github.com/pNre/ExSwift/blob/f1411fc6320a053afca00ef975648c975a30ca75/ExSwift/Array.swift#L407-420">代码</a>）。这样第一个问题解决了——找到了从数组中随机选取元素的方式。</p>

<p>下面是第二个问题。我之所以想实现延迟，是因为这个应用的功能太简单，运行的很快，就像没运行一样。为了让它看起来在背后做了很多事情，我想让结果等待一段时间再出现（在弹出窗口中）。可是怎么实现延迟呢？我首先想到的是“sleep”。可是 <code class="highlighter-rouge">sleep()</code> 函数和 <code class="highlighter-rouge">NSThread.
sleepForTimeInterval(_:)</code> 方法都会导致 UI 无响应，就像假死一样。经过一番搜索之后，我知道这种效果应该使用 <code class="highlighter-rouge">dispatch_after(_:_:_:)</code> 函数实现。现在还剩最后一个问题了。</p>

<p>我前面一直在用“弹出”这个词，因为我以为我要实现的效果是“pop-up”。可是搜了好久都没找到相关的 API，最后才发现应该使用“提醒”（<code class="highlighter-rouge">NSAlert</code>）。不过在使用 <code class="highlighter-rouge">beginSheetModalForWindow(_:completionHandler:)</code> 方法时，处理回调用了很长时间。这体现了我对 Swift 语言（尤其是闭包）的理解还很浅显。</p>

<p>大概用了三个小时，期间不断地搜索、查 API 文档和纠错，最终这个应用总算实现了规划的功能，顺利运行起来了。</p>

<p class="text-center"><img src="/assets/images/figures/LuckyMan.png" alt="LuckyMan" /></p>

<p>这是我自己规划功能、自己动手开发的第一个 Mac APP，因此特写此文，以作纪念。在开发的过程中，我学到了：</p>

<ul>
  <li>Swift 语言是基础</li>
  <li>大部分工作是要熟悉 Cocoa API</li>
  <li>Dash 买得值</li>
</ul>

<p>我想，再过一段时间这个应用就能派上用场了。</p>

  </main>

  <footer>
    <p class="mt-20 text-center">~~~ EoF. 感谢阅读！~~~</p>
  </footer>
</article>

</main>

<footer class="mt-20">
  <p>&copy;1988-&infin;。如无特殊说明，本站文章基于“<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" title="CC BY-NC-SA 3.0" target="_blank" rel="noopenner">CC BY-NC-SA 3.0</a>”协议发布。</p>
  <p>使用 <a href="https://bridgetownrb.com/" title="Bridgetownrb" target="_blank" rel="noopenner">Bridgetownrb</a> 构建，使用 <a href="https://draculatheme.com/" title="Dracula" target="_blank" rel="noopenner">Dracula</a> 配色，部署在 <a href="https://pages.github.com/" title="GitHub Pages" target="_blank" rel="noopenner">GitHub Pages</a> 上。</p>
  <p>感谢开放的网络世界。</p>
</footer>

</div>
</body>
</html>

