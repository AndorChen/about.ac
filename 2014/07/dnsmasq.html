<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>安装 DNSMasq - Andor Chen</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="renderer" content="webkit" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="description" content="安道的个人网站" />
  <meta name="author" content="安道" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link type="application/atom+xml" rel="alternate" href="https://about.ac/feed.xml" title="Andor Chen" />
  <link rel="stylesheet" href="/_bridgetown/static/index.HQI6VUTV.css" />
  <script src="/_bridgetown/static/index.3QSIHARC.js" defer></script>
  
</head>
<body class="bg-dracula-darker text-dracula-light">

<div class="px-6 py-8 md:px-16 lg:px-24 lg:py-16">
  
  <header class="max-w-prose mb-12">
    <div class="flex flex-row">
      <div class="basis-1/6 flex-auto"><a href="/" title="安道"><img src="/assets/images/painting.png" alt="Andor's Avatar" class="rounded-full w-32" /></a></div>
      <div class="basis-5/6 flex-auto self-center"><span class="pl-8 text-4xl font-medium"><a href="/" title="安道">安道</a></span></div>
    </div>
  </header>

  <main>

<div class="mb-4">
  <a href="/" title="首页">首页</a> // <a href="/archive/" title="文章归档">文章归档</a>
</div>


<article class="prose prose-invert">
  <header>
    <h1 class="text-dracula-green">安装 DNSMasq</h1>
    <p>（发布于 2014 年 7 月 29 日）</p>
  </header>

  <main>
    <p>连接 VPN 之后，经常打不开国内的某些网站。经高人指点，这是 DNS 的问题，推荐使用 <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">DNSMasq</a>，在本机架设简易的 DNS 服务器，让 VPN 使用本地服务器解析域名。以下对安装的过程做一记录，以备不时之需。</p>

<h2>安装 DNSMasq</h2>

<p>我使用的系统是 Mac OS X，因此使用 homebrew 安装。安装方式如下：</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew up &amp; brew <span class="nb">install </span>dnsmasq
</code></pre></div></div>

<p>DNSMasq 比较小，下载过程很快。</p>

<p>然后，根据 homebrew 的提示，执行几个命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf
<span class="nv">$ </span><span class="nb">sudo cp</span> <span class="nt">-fv</span> /usr/local/opt/dnsmasq/<span class="k">*</span>.plist /Library/LaunchDaemons
<span class="nv">$ </span><span class="nb">sudo </span>launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist
</code></pre></div></div>

<p>这三个命令的作用分别是：</p>

<ul>
  <li>把配置示例复制到指定位置；</li>
  <li>把 DNSMasq 加入启动列表，开机自启动；</li>
  <li>手动启动 DNSMasq。</li>
</ul>

<p>为了操作方便，我还定义了两个命令别名，用于手动启动和停止 DNSMasq：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span>start-dnsmasq<span class="o">=</span><span class="s2">"sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist"</span>

<span class="nb">alias </span>stop-dnsmasq<span class="o">=</span><span class="s2">"sudo launchctl unload /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist"</span>
</code></pre></div></div>

<h2>配置 DNSMasq</h2>

<p>DNSMasq 的配置文件是 <code class="highlighter-rouge">/usr/local/etc/dnsmasq.conf</code>。在文本编辑器中打开，在文件末尾写入如下设置（<a href="https://ruby-china.org/topics/20270">via</a>）：</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span>=<span class="m">8</span>.<span class="m">8</span>.<span class="m">8</span>.<span class="m">8</span>
<span class="n">server</span>=<span class="m">8</span>.<span class="m">8</span>.<span class="m">4</span>.<span class="m">4</span>

<span class="c">#Bilibili
</span><span class="n">server</span>=/<span class="n">bilibili</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#fm
</span><span class="n">server</span>=/<span class="n">jing</span>.<span class="n">fm</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">xiami</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Baidu
</span><span class="n">server</span>=/<span class="n">baidu</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">bdstatic</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#QQ
</span><span class="n">server</span>=/<span class="n">qq</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">qcloud</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Taobao
</span><span class="n">server</span>=/<span class="n">taobao</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">tmall</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">alipay</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">alibaba</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">taobaocdn</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Sina
</span><span class="n">server</span>=/<span class="n">sina</span>.<span class="n">com</span>.<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">weibo</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#163
</span><span class="n">server</span>=/<span class="m">163</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">youdao</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">netease</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Zhihu
</span><span class="n">server</span>=/<span class="n">zhihu</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">zhimg</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Apple
</span><span class="n">server</span>=/<span class="n">apple</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">autonavi</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Sohu
</span><span class="n">server</span>=/<span class="n">sohu</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">sogou</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Ifeng
</span><span class="n">server</span>=/<span class="n">ifeng</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">360</span>.<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>


<span class="c">#Youku
</span><span class="n">server</span>=/<span class="n">youku</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">ykimg</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">tudou</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">soku</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#douban
</span><span class="n">server</span>=/<span class="n">douban</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#TV
</span><span class="n">server</span>=/<span class="n">pptv</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">ppstream</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">pps</span>.<span class="n">tv</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">letv</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">56</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">58</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">iqiyi</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">cntv</span>.<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#ShopMall
</span><span class="n">server</span>=/<span class="m">51</span><span class="n">buy</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">yixun</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">yihaodian</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">dangdang</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">qunar</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">meituan</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">jd</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">360</span><span class="n">buyimg</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Xunlei
</span><span class="n">server</span>=/<span class="n">xunlei</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">kankan</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Ruby China
</span><span class="n">server</span>=/<span class="n">ruby</span>-<span class="n">china</span>.<span class="n">org</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#CDN
</span><span class="n">server</span>=/<span class="n">tanx</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">aliyun</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">upaiyun</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Map
</span><span class="n">server</span>=/<span class="n">amap</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">hvvc</span>.<span class="n">us</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#cn
</span><span class="n">server</span>=/<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#guokr
</span><span class="n">server</span>=/<span class="n">guokr</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
</code></pre></div></div>

<p>如果之前已经启动 DNSMasq，现在重启。</p>

<h2>配置 VPN</h2>

<p>打开 VPN 的高级设置，在 DNS 选项卡中填入 <code class="highlighter-rouge">127.0.0.1</code>，让 VPN 使用本地 DNS 服务器解析域名。</p>

  </main>

  <footer>
    <p class="mt-20 text-center">~~~ EoF. 感谢阅读！~~~</p>
  </footer>
</article>

</main>

<footer class="mt-20">
  <p>&copy;1988-&infin;。如无特殊说明，本站文章基于“<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" title="CC BY-NC-SA 3.0" target="_blank" rel="noopenner">CC BY-NC-SA 3.0</a>”协议发布。</p>
  <p>使用 <a href="https://bridgetownrb.com/" title="Bridgetownrb" target="_blank" rel="noopenner">Bridgetownrb</a> 构建，使用 <a href="https://draculatheme.com/" title="Dracula" target="_blank" rel="noopenner">Dracula</a> 配色，部署在 <a href="https://pages.github.com/" title="GitHub Pages" target="_blank" rel="noopenner">GitHub Pages</a> 上。</p>
  <p>感谢开放的网络世界。</p>
</footer>

</div>
</body>
</html>

