<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"/><title>安装 DNSMasq - Andor Chen</title><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="renderer" content="webkit"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="description" content="安道的个人网站"/><meta name="author" content="安道"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="stylesheet" href="/assets/style.css"/><script src="/assets/js/global.js" async></script></head><body class="single-post-page"><div class="wrapper"><header id="site_header" class="header mobile-menu-hide"><div class="avatar"><a href="/" title="首页"><img src="/assets/images/painting.png" alt="Andor's Avatar"/></a><div class="mask"></div><!-- ? --></div><div class="site-title-block"><h1 class="site-title"><a href="/" title="首页">安道</a></h1><p class="site-description">高校教师<br/>自由翻译</p></div><div class="site-nav"><ul id="nav" class="site-main-menu"><li><a href="/" title="">首页</a></li><li><a href="/books/" title="">图书</a></li><li class="active"><a href="/archive/" title="">文章</a></li></ul><ul class="social-links"><li><a href="https://twitter.com/Andor_Chen" title="Twitter" target="_blank" rel="noopenner"><i class="icon-twitter"></i></a></li><li><a href="https://github.com/AndorChen" title="GitHub" target="_blank" rel="noopenner"><i class="icon-github-circled"></i></a></li><li><a href="/contact/" title="联系安道"><i class="icon-wechat"></i></a></li><li><a href="/feed.xml" title="订阅网站更新"><i class="icon-rss"></i></a></li></ul></div></header><div class="mobile-header mobile-visible"><div class="mobile-logo-container"><div class="mobile-site-title">安道</div></div><a class="menu-toggle mobile-visible"><i class="icon-menu"></i></a></div><div id="main" class="site-main"><div class="inner-main"><section class="section"><div class="section-header"><h1 class="section-title">博客文章</h1></div><div class="section-content"><div class="breadcrumbs"><a href="/" title="首页">首页</a> // <a href="/archive/" title="文章归档">文章归档</a></div><article class="hentry entry"><header class="entry-header"><h1 class="entry-title">安装 DNSMasq</h1><p class="entry-meta">发布于 2014 年 7 月 29 日</p></header><div class="entry-content"><p>连接 VPN 之后，经常打不开国内的某些网站。经高人指点，这是 DNS 的问题，推荐使用 <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html" title="DNSMasq">DNSMasq</a>，在本机架设简易的 DNS 服务器，让 VPN 使用本地服务器解析域名。以下对安装的过程做一记录，以备不时之需。</p><h2>安装 DNSMasq</h2><p>我使用的系统是 Mac OS X，因此使用 homebrew 安装。安装方式如下：</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew up &amp; brew <span class="nb">install </span>dnsmasq
</code></pre></div></div><p>DNSMasq 比较小，下载过程很快。</p><p>然后，根据 homebrew 的提示，执行几个命令：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf
<span class="nv">$ </span><span class="nb">sudo cp</span> <span class="nt">-fv</span> /usr/local/opt/dnsmasq/<span class="k">*</span>.plist /Library/LaunchDaemons
<span class="nv">$ </span><span class="nb">sudo </span>launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist
</code></pre></div></div><p>这三个命令的作用分别是：</p><ul><li>把配置示例复制到指定位置；</li><li>把 DNSMasq 加入启动列表，开机自启动；</li><li>手动启动 DNSMasq。</li></ul><p>为了操作方便，我还定义了两个命令别名，用于手动启动和停止 DNSMasq：</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span>start-dnsmasq<span class="o">=</span><span class="s2">"sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist"</span>

<span class="nb">alias </span>stop-dnsmasq<span class="o">=</span><span class="s2">"sudo launchctl unload /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist"</span>
</code></pre></div></div><h2>配置 DNSMasq</h2><p>DNSMasq 的配置文件是 <code class="language-plaintext highlighter-rouge">/usr/local/etc/dnsmasq.conf</code>。在文本编辑器中打开，在文件末尾写入如下设置（<a href="https://ruby-china.org/topics/20270" title="via">via</a>）：</p><div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span>=<span class="m">8</span>.<span class="m">8</span>.<span class="m">8</span>.<span class="m">8</span>
<span class="n">server</span>=<span class="m">8</span>.<span class="m">8</span>.<span class="m">4</span>.<span class="m">4</span>

<span class="c">#Bilibili
</span><span class="n">server</span>=/<span class="n">bilibili</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#fm
</span><span class="n">server</span>=/<span class="n">jing</span>.<span class="n">fm</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">xiami</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Baidu
</span><span class="n">server</span>=/<span class="n">baidu</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">bdstatic</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#QQ
</span><span class="n">server</span>=/<span class="n">qq</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">qcloud</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Taobao
</span><span class="n">server</span>=/<span class="n">taobao</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">tmall</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">alipay</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">alibaba</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">taobaocdn</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Sina
</span><span class="n">server</span>=/<span class="n">sina</span>.<span class="n">com</span>.<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">weibo</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#163
</span><span class="n">server</span>=/<span class="m">163</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">youdao</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">netease</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Zhihu
</span><span class="n">server</span>=/<span class="n">zhihu</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">zhimg</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Apple
</span><span class="n">server</span>=/<span class="n">apple</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">autonavi</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Sohu
</span><span class="n">server</span>=/<span class="n">sohu</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">sogou</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Ifeng
</span><span class="n">server</span>=/<span class="n">ifeng</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">360</span>.<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>


<span class="c">#Youku
</span><span class="n">server</span>=/<span class="n">youku</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">ykimg</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">tudou</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">soku</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#douban
</span><span class="n">server</span>=/<span class="n">douban</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#TV
</span><span class="n">server</span>=/<span class="n">pptv</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">ppstream</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">pps</span>.<span class="n">tv</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">letv</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">56</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">58</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">iqiyi</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">cntv</span>.<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#ShopMall
</span><span class="n">server</span>=/<span class="m">51</span><span class="n">buy</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">yixun</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">yihaodian</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">dangdang</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">qunar</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">meituan</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">jd</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="m">360</span><span class="n">buyimg</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Xunlei
</span><span class="n">server</span>=/<span class="n">xunlei</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">kankan</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Ruby China
</span><span class="n">server</span>=/<span class="n">ruby</span>-<span class="n">china</span>.<span class="n">org</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#CDN
</span><span class="n">server</span>=/<span class="n">tanx</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">aliyun</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">upaiyun</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#Map
</span><span class="n">server</span>=/<span class="n">amap</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
<span class="n">server</span>=/<span class="n">hvvc</span>.<span class="n">us</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#cn
</span><span class="n">server</span>=/<span class="n">cn</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>

<span class="c">#guokr
</span><span class="n">server</span>=/<span class="n">guokr</span>.<span class="n">com</span>/<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>.<span class="m">114</span>
</code></pre></div></div><p>如果之前已经启动 DNSMasq，现在重启。</p><h2>配置 VPN</h2><p>打开 VPN 的高级设置，在 DNS 选项卡中填入 <code class="language-plaintext highlighter-rouge">127.0.0.1</code>，让 VPN 使用本地 DNS 服务器解析域名。</p></div></article><ul class="pager"><li class="previous"><a rel="prev" href="/2014/06/duokan-xhtml-entities.html" title="多看对 XHTML 实体的支持">&laquo; 上一篇文章</a></li><li class="next"><a rel="next" href="/2014/11/mavericks.html" title="升级到 Mavericks">下一篇文章 &raquo;</a></li></ul></div></section><footer class="footer"><p class="copyright">&copy;1988-&infin;。如无特殊说明，本站文章基于“<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" title="CC BY-NC-SA 3.0" target="_blank">CC BY-NC-SA 3.0</a>”协议发布。</p><p class="powered-by"><a href="http://jekyllrb.com" title="本站使用 Jekyll 生成" target="_blank"><img src="/assets/images/jekyll-logo@2x.png" width="60" height="24" alt="Jekyll Logo" title="本站使用 Jekyll 生成"/></a></p></footer></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69344223-1', 'auto');
  ga('send', 'pageview');</script></body></html>